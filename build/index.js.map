{"version":3,"sources":["../server/index.js"],"names":["AutoService","require","compression","path","express","app","use","config","process","env","rootPath","join","__dirname","static","get","req","res","next","sendFile","root","updating","autoUpdateFeed","updateService","autoUpdateTime","setInterval","deleteOldSource","runService","info","json","server","createServer","NODE_ENV","start","reload","setTimeout","set","PORT","HOST","listen","console","log"],"mappings":"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","file":"index.js","sourcesContent":["import { getFeedSourceInfo } from \"./db/helper\";\nconst AutoService = require(\"./src/service\");\nvar compression = require(\"compression\");\nconst path = require(\"path\");\nconst express = require(\"express\");\nconst app = express();\napp.use(compression());\nconst config = require(\"../config/config.json\");\nprocess.env.rootPath = path.join(__dirname, \"..\");\nconst rootPath = process.env.rootPath;\n\n// setting files of static to server easily\napp.use(express.static(path.join(rootPath, \"client\")));\napp.use(express.static(path.join(rootPath, \"store\")));\n\n// -------------import routing Include server routes as a middleware\n\napp.get(\"/\", function(req, res, next) {\n  res.sendFile(\"./index.html\", { root: rootPath });\n});\n\nif (config.updating.autoUpdateFeed) {\n  var updateService = new AutoService(config.updating.autoUpdateTime); // intilize the service\n  setInterval(() => updateService.deleteOldSource(), 60000 * 60 * 6);\n  setInterval(\n    () => updateService.runService(),\n    config.updating.autoUpdateTime * 60000\n  ); // run service at specific intercal set in config\n\n  app.get(\"/source_info\", async function(req, res, next) {\n    let info = await getFeedSourceInfo();\n    if (info) res.json(info);\n  });\n\n  /*\n  app.get(\"/latest/:feedSource\", function(req, res, next) {\n    let sourceName = req.params.feedSource;\n    if (req.params && sourceName !== \"\" && typeof sourceName === \"string\")\n      return res.json({\n        serviceRunning: updateService.serviceRunnng,\n        nextUpdate: moment(updateService.nextUpdate).fromNow(),\n        items: updateService.updatedMerge[req.params.feedSource]\n      });\n    console.error(\"Invalid request!!\");\n    next();\n  });\n  app.get(\"/next_update\", function(req, res, next) {\n    res.json({\n      error: updateService.error,\n      serviceRunning: updateService.serviceRunnng,\n      nextUpdate: moment(updateService.nextUpdate).fromNow(),\n      feeds: updateService.updatedMerge\n    });\n  });\n  */\n} // end of #if config.update.AutoupdateFeed\n\nvar server = require(\"http\").createServer(app);\n\nif (process.env.NODE_ENV === \"development\") {\n  require(\"pretty-error\").start();\n  const reload = require(\"reload\");\n  reload(server, app);\n  require(path.join(path.join(rootPath, \"./dev-server\")))(app);\n} else {\n  app.use(express.static(path.join(rootPath, \"www\")));\n  setTimeout(() => updateService.runService(), 10000); // run the servie at initial startup\n}\n\napp.set(\"port\", process.env.PORT || 3000);\napp.set(\"host\", process.env.HOST || \"localhost\");\n\nserver.listen(app.get(\"port\"), function() {\n  console.log(\n    \"%s server listening at http://%s:%s\",\n    process.env.NODE_ENV,\n    app.get(\"host\"),\n    app.get(\"port\")\n  );\n});\n"]}