{"version":3,"sources":["../../server/src/serveFeed.js"],"names":["feedSource","JSON","parse","stringify","serveFeed","sourceTitle","lastUpdate","lastFirstFeedTitle","Object","keys","feedManage","sourceUrl","initCollect","catch","Error","e"],"mappings":";;;;;;AAAA;;;;AACA;;;;;;AACA,IAAIA,aAAaC,KAAKC,KAAL,CAAWD,KAAKE,SAAL,kBAAX,CAAjB;;AAEA;;;;;;;;;;;;;;;;;;;AAmBA;;;;;AAKA,IAAMC,YAAY,SAAZA,SAAY,CAACC,WAAD,EAAcC,UAAd,EAA6B;AAC7C,MAAIA,WAAWD,WAAX,CAAJ,EAA6B;AAC3B,QAAIE,qBAAqBC,OAAOC,IAAP,CAAYH,WAAWD,WAAX,EAAwB,OAAxB,CAAZ,EAA8C,CAA9C,CAAzB,CAD2B,CACgD;AAC5E;AACD,MAAIK,aAAa,0BACfL,WADe,EAEfL,WAAWK,WAAX,EAAwBM,SAFT,EAEoB;AACnCJ,oBAHe,CAAjB;AAKA,MAAIK,cAAcF,WAAWE,WAAX,GAAyBC,KAAzB,CAA+B,aAAK;AACpD,UAAMC,MAAMC,CAAN,CAAN;AACD,GAFiB,CAAlB;AAGA,SAAOH,WAAP;AACD,CAbD;;eAeeR,S;;;AAEf;;;;;;;;;;;;;;;;;;;;;;gCA3CIJ,U;;gCA0BEI,S","file":"serveFeed.js","sourcesContent":["import CollectFeed from \"./collectFeed\";\nimport source from \"../../config/source.json\";\nlet feedSource = JSON.parse(JSON.stringify(source));\n\n/*\nconst saveFetchInfo = (sourceTitle, feedLength, fileName) => {\n  var params = {\n    TableName: \"FeedSourceInfo\",\n    Key: {\n      sourceTitle: sourceTitle\n    },\n    UpdateExpression: \"set lastFetched =:dt, feedItem = :item , fileName=:fileName\",\n    ExpressionAttributeValues: {\n      \":dt\": Date.now(),\n      \":item\": feedLength,\n      \":fileName\": fileName\n    },\n    ReturnValues: \"UPDATED_NEW\"\n  };\n  return updateItem(params);\n};\n*/\n\n/**\n * It will fetch the feeds and parse it & save it as json\n * Souce can be user specific souce or all souce which saved by defualt\n * @param {object} source\n */\nconst serveFeed = (sourceTitle, lastUpdate) => {\n  if (lastUpdate[sourceTitle]) {\n    var lastFirstFeedTitle = Object.keys(lastUpdate[sourceTitle][\"feeds\"])[0]; // title of first item of last fetched feed item\n  }\n  let feedManage = new CollectFeed(\n    sourceTitle,\n    feedSource[sourceTitle].sourceUrl, // get sourceinfo from saved json file\n    lastFirstFeedTitle\n  );\n  let initCollect = feedManage.initCollect().catch(e => {\n    throw Error(e);\n  });\n  return initCollect;\n};\n\nexport default serveFeed;\n\n/*\n  feedSource[sourceT&itle][\"lastfetch\"] = Date.now();\n  feedSource[sourceTitle][\"feedLength\"] = feedLength;\n  return new Promise((resolve, reject) => {\n    fs.writeFile(\n      path.join(rootPath, \"/feedNew.json\"),\n      JSON.stringify(feedSource),\n      (e, r) => {\n        if (e) return reject(e);\n        return resolve(true);\n      }\n    );\n  });\n  */\n"]}